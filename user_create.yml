#Ansible Playbook
#User Creation

#command to execute: ansible playbook -v -i /etc/ansible/hosts user_create.yml --ask-become-pass

    - hosts: workstations
      user: chatrr
      become: yes
      become_method: sudo
      become_user: root
      gather_facts: yes
      tasks:

        - name: Creating "CYOTE" group
          remote_user: chatrr
          become: yes
          become_method: sudo
          group:
             name: CYOTE
             gid: 2010
             state: present

#        - name: Adding user "CYOTE" to CYOTE group         
#          user:
#            name: cyote
#            password: '$6$58wtQJB3a$N8AG9hCnaxlJYSL1draFV18ybepFOync83uGAR64YdKHZY31l0Eg6ze1mCVUPJvafqRinaAViltfYRU/5ph5g1'
#            comment: "cyote"
#            uid: 2001
#            groups:
#             - sudo
#             - CYOTE
#            state: present
#            append: yes
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes           
#            home: /home/cyote 
#            update_password: on_create
          
#        ALL USERNAME are first four of the lastname, first intial, middle intial
#        - name: Adding user "<NAME>" to CYOTE group
#          user: 
#            name: <lastname,firstintial,middleintial>
#            comment: "<username>"
#            uid: <200#>
#            group: CYOTE #use this if they are not a privileged user
#            groups:
#             - sudo
#             - CYOTE
#            append: yes
#            state: present
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes
#            home: /home/<username>
#            update_password: on_create

        - name: Add user "Andrew" to CYOTE group
          user:
            name: aguiat
            password: '$6$58wtQJB3a$N8AG9hCnaxlJYSL1draFV18ybepFOync83uGAR64YdKHZY31l0Eg6ze1mCVUPJvafqRinaAViltfYRU/5ph5g1'
            comment: "Andrew Aguire"
            uid: 2002
            group: CYOTE
            groups:
              - sudo
              - CYOTE
            state: present
            append: yes
            shell: /bin/bash
            generate_ssh_key: yes
            ssh_key_bits: 2048
            ssh_key_file: .ssh/id_rsa
            system: no
            createhome: yes
            home: /home/aguiat 
            update_password: on_create

#        - name: Add user "Rishi" to CYOTE group
#          user:
#            name: chatrr
#            password: '$6$58wtQJB3a$N8AG9hCnaxlJYSL1draFV18ybepFOync83uGAR64YdKHZY31l0Eg6ze1mCVUPJvafqRinaAViltfYRU/5ph5g1'
#            comment: "Rishi Chatterjee"
#            uid: 2003
#            group: CYOTE
#            groups:
#              - sudo
#              - CYOTE
#            state: present
#            append: yes
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes
#            home: /home/chatrr           
#            update_password: on_create

#        - name: Add user "Willis" to CYOTE group
#          user:
#            name: jordwm
#            password: '$6$58wtQJB3a$N8AG9hCnaxlJYSL1draFV18ybepFOync83uGAR64YdKHZY31l0Eg6ze1mCVUPJvafqRinaAViltfYRU/5ph5g1'
#            comment: "Willis Jordan"
#            uid: 2004
#            group: CYOTE
#            groups:
#              - sudo
#              - CYOTE
#            state: present
#            append: yes
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes
#            home: /home/jordwm           
#            update_password: on_create

#        - name: Add user "Lawrence" to CYOTE group
#          user:
#            name: welllr
#            password: '$6$58wtQJB3a$N8AG9hCnaxlJYSL1draFV18ybepFOync83uGAR64YdKHZY31l0Eg6ze1mCVUPJvafqRinaAViltfYRU/5ph5g1'
#            comment: "Lawrence Wellman"
#            uid: 2005
#            group: CYOTE
#            groups:
#              - sudo
#              - CYOTE
#            state: present
#            append: yes
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes
#            home: /home/welllr           
#            update_password: on_create
       
#        - name: Add user "Edward" to CYOTE group
#          user:
#            name: spriee
#            password: '$6$58wtQJB3a$N8AG9hCnaxlJYSL1draFV18ybepFOync83uGAR64YdKHZY31l0Eg6ze1mCVUPJvafqRinaAViltfYRU/5ph5g1'
#            comment: "Edward Springer"
#            uid: 2006
#            group: CYOTE
#            groups:
#              - sudo
#              - CYOTE
#            state: present
#            append: yes
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes
#            home: /home/spriee        
#            update_password: on_create

#        - name: Forcing password change for user
#          remote_user: aguiat
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -d 0 cyote

        - name: Forcing password change for user "Andrew Aguire"
          remote_user: chatrr
          become: yes
          become_method: sudo
          become_user: root
          command:
           chage -d 0 aguiat

#        - name: Forcing password change for user "Rishi Chatterjee"
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -d 0 chatrr

#        - name: Forcing password change for user "Willis Jordan"
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -d 0 jordwm

#        - name: Forcing password change for user "Lawrence Wellman"
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -d 0 welllr

#        - name: Forcing password change for user "Edward Springer"
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -d 0 spriee

#        - name: Forcing user "EXAMPLE" to set password to expire every 3 months and can only change password once every week
#          remote_user: cyote
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -M 90 -m 7 -I 30 -W 14 <username>

        - name: Forcing user "Andrew Aguire" to set password to expire every 3 months and can only change password once every week
          remote_user: chatrr
          become: yes
          become_method: sudo
          become_user: root
          command:
           chage -M 90 -m 7 -I 30 -W 14 aguiat

#        - name: Forcing user "Rishi Chatterjee" to set password to expire every 3 months and can only change password once every week
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -M 90 -m 7 -I 30 -W 14 chatrr

#        - name: Forcing user "Willis Jordan" to set password to expire every 3 months and can only change password once every week
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -M 90 -m 7 -I 30 -W 14 jordwm

#        - name: Forcing user "Lawrence Wellman" to set password to expire every 3 months and can only change password once every week
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -M 90 -m 7 -I 30 -W 14 welllr

#        - name: Forcing user "Edward Springer" to set password to expire every 3 months and can only change password once every week
#          remote_user: jordwm
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -M 90 -m 7 -I 30 -W 14 spriee


#    - hosts: workstations
#      user: cyote
#      become: yes
#      become_method: sudo
#      become_user: root
#      vars:
#            users: ['ansibletst'] #usernames ['user1','user2']
#            user_password_valid_time: 90

#      tasks:

#       - name: Check for users password validation time
#         shell: getent shadow "{{ item }}" | cut -d':' -f5
#         register: users_pw_valid
#         loop: users
#         change_when: False

#       - name: Set users password validation time
#         shell: chage -M "{{ user_password_valid_time }}" "{{ item['item'] }}"
#         loop: users_pw_valid.results
#         when: item.stdout is defined and item.stdout != {{ user_password_valid_time }}




