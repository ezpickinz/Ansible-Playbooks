#Ansible Playbook
#User Creation

#command to execute: ansible playbook -v -i /etc/ansible/hosts user_create.yml --ask-become-pass

    - hosts: workstations
      user: <username>
      become: yes
      become_method: sudo
      become_user: root
      gather_facts: yes
      tasks:

        - name: Creating "<GROUPNAME>" group
          remote_user: <username>
          become: yes
          become_method: sudo
          group:
             name: <name of GROUP>
             gid: 2010
             state: present

#        - name: Adding user "Ansible Test" to example group         
#          user:
#            name: ansibletst
#            password: '<hashed password>'
#            comment: "Ansibletst"
#            uid: 2001
#            groups:
#             - sudo
#             - example
#            state: present
#            append: yes
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes           
#            home: /home/ansibletst 
#            update_password: on_create
          
#        ALL USERNAME are first four of the lastname, first intial, middle intial
#        - name: Adding user "<NAME>" to example group
#          user: 
#            name: <lastname,firstintial,middleintial>
#            comment: "<username>"
#            uid: <200#>
#            group: CYOTE #use this if they are not a privileged user
#            groups:
#             - sudo
#             - example
#            append: yes
#            state: present
#            shell: /bin/bash
#            generate_ssh_key: yes
#            ssh_key_bits: 2048
#            ssh_key_file: .ssh/id_rsa
#            system: no
#            createhome: yes
#            home: /home/<username>
#            update_password: on_create

        - name: Add user "John" to <GROUPNAME> group
          user:
            name: johns
            password: '<hashed password>'
            comment: "John Smith"
            uid: 2002
#            group: <GROUP name if only adding to one group>
            groups:
              - sudo
              - <GROUPNAME>
            state: present
            append: yes
            shell: /bin/bash
            generate_ssh_key: yes
            ssh_key_bits: 2048
            ssh_key_file: .ssh/id_rsa
            system: no
            createhome: yes
            home: /home/johns 
            update_password: on_create

       
#        - name: Forcing password change for user
#          remote_user: <username>
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -d 0 <username>

        - name: Forcing password change for user "John Smith"
          remote_user: <username>
          become: yes
          become_method: sudo
          become_user: root
          command:
           chage -d 0 johns  

#        - name: Forcing user "EXAMPLE" to set password to expire every 3 months and can only change password once every week
#          remote_user: <username>
#          become: yes
#          become_method: sudo
#          become_user: root
#          command:
#           chage -M 90 -m 7 -I 30 -W 14 <username>

        - name: Forcing user "John Smith" to set password to expire every 3 months and can only change password once every week.
          remote_user: <username>
          become: yes
          become_method: sudo
          become_user: root
          command:
          chge -M 90 -m 7 -I 30 -W 14 johns

#        - name: remove user "ANSIBLE TEST"
#          remote_user: <username>
#          become: yes
#          become_method: sudo
#          become_user: root
#          user:
#            name: ansibletst
#            state: absent
#           remove: yes
#           force: yes

#        - name: Removing user "John Smith"
#          remote_user: <username>
#          become: yes
#          become_method: sudo
#          become_user: root
#          user:
#            name: johns
#            state: absent
#            remove: yes
#            force: yes


#    - hosts: workstations
#      user: <username>
#      become: yes
#      become_method: sudo
#      become_user: root
#      vars:
#            users: ['ansibletst'] #usernames ['user1','user2']
#            user_password_valid_time: 90

#      tasks:

#       - name: Check for users password validation time
#         shell: getent shadow "{{ item }}" | cut -d':' -f5
#         register: users_pw_valid
#         loop: users
#         change_when: False

#       - name: Set users password validation time
#         shell: chage -M "{{ user_password_valid_time }}" "{{ item['item'] }}"
#         loop: users_pw_valid.results
#         when: item.stdout is defined and item.stdout != {{ user_password_valid_time }}




